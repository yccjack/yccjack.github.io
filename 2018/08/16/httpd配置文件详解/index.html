<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>HTTPD | MysticalYcc</title><meta name="description" content="Apache HTTP Server（简称Apache或httpd）是Apache软件基金会的一个开放源代码的网页服务器软件，旨在为unix，windows等操作系统中提供开源httpd服务。由于其安全性、高效性及可扩展性，被广泛使用，自1996年4月以来，Apache一直是Internet上最流行的HTTP服务器。它快速、可靠并且可通过简单的API扩充，将Perl／Python等解释器等编译到h"><meta name="keywords" content="服务器"><meta name="author" content="俞超超"><meta name="copyright" content="俞超超"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="https://gschaos.club/2018/08/16/httpd%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E8%AF%A6%E8%A7%A3/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><meta property="og:type" content="article"><meta property="og:title" content="HTTPD"><meta property="og:url" content="https://gschaos.club/2018/08/16/httpd%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E8%AF%A6%E8%A7%A3/"><meta property="og:site_name" content="MysticalYcc"><meta property="og:description" content="Apache HTTP Server（简称Apache或httpd）是Apache软件基金会的一个开放源代码的网页服务器软件，旨在为unix，windows等操作系统中提供开源httpd服务。由于其安全性、高效性及可扩展性，被广泛使用，自1996年4月以来，Apache一直是Internet上最流行的HTTP服务器。它快速、可靠并且可通过简单的API扩充，将Perl／Python等解释器等编译到h"><meta property="og:image" content="https://gschaos.club/null"><meta property="article:published_time" content="2018-08-15T16:00:00.000Z"><meta property="article:modified_time" content="2020-09-03T07:20:23.000Z"><meta name="twitter:card" content="summary"><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css"><script>var GLOBAL_CONFIG = { 
  root: '/',
  hexoversion: '5.0.0',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  bookmark: {
    message_prev: '按',
    message_next: '键将本页加入书签'
  },
  runtime: '',
  date_suffix: {"one_hour":"刚刚","hours":"小时前","day":"天前"},
  copyright: undefined,
  ClickShowText: undefined,
  medium_zoom: false,
  fancybox: true,
  Snackbar: undefined,
  justifiedGallery: {
    js: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/js/jquery.justifiedGallery.min.js',
    css: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/css/justifiedGallery.min.css'
  },
  baiduPush: false,
  isPhotoFigcaption: false,
  islazyload: false,
  isanchor: false
};

var saveToLocal = {
  set: function setWithExpiry(key, value, ttl) {
    const now = new Date()
    const expiryDay = ttl * 86400000
    const item = {
      value: value,
      expiry: now.getTime() + expiryDay,
    }
    localStorage.setItem(key, JSON.stringify(item))
    },

  get: function getWithExpiry(key) {
    const itemStr = localStorage.getItem(key)

    if (!itemStr) {
      return undefined
    }
    const item = JSON.parse(itemStr)
    const now = new Date()

    if (now.getTime() > item.expiry) {
      localStorage.removeItem(key)
      return undefined
    }
    return item.value
  }
}</script><script id="config_change">var GLOBAL_CONFIG_SITE = { 
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isSidebar: true,
  postUpdate: '2020-09-03 15:20:23'
}</script><noscript><style type="text/css">
#nav {
  opacity: 1
}
.justified-gallery img {
  opacity: 1
}
</style></noscript><script>var activateDarkMode = function () {
  document.documentElement.setAttribute('data-theme', 'dark')
  if (document.querySelector('meta[name="theme-color"]') !== null) {
    document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
  }
}
var activateLightMode = function () {
  document.documentElement.setAttribute('data-theme', 'light')
  if (document.querySelector('meta[name="theme-color"]') !== null) {
    document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
  }
}

var autoChangeMode = 'false'
var t = saveToLocal.get('theme')
if (autoChangeMode === '1') {
  var isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches
  var isLightMode = window.matchMedia('(prefers-color-scheme: light)').matches
  var isNotSpecified = window.matchMedia('(prefers-color-scheme: no-preference)').matches
  var hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

  if (t === undefined) {
    if (isLightMode) activateLightMode()
    else if (isDarkMode) activateDarkMode()
    else if (isNotSpecified || hasNoSupport) {
      var now = new Date()
      var hour = now.getHours()
      var isNight = hour <= 6 || hour >= 18
      isNight ? activateDarkMode() : activateLightMode()
    }
    window.matchMedia('(prefers-color-scheme: dark)').addListener(function (e) {
      if (saveToLocal.get('theme') === undefined) {
        e.matches ? activateDarkMode() : activateLightMode()
      }
    })
  } else if (t === 'light') activateLightMode()
  else activateDarkMode()
} else if (autoChangeMode === '2') {
  now = new Date()
  hour = now.getHours()
  isNight = hour <= 6 || hour >= 18
  if (t === undefined) isNight ? activateDarkMode() : activateLightMode()
  else if (t === 'light') activateLightMode()
  else activateDarkMode()
} else {
  if (t === 'dark') activateDarkMode()
  else if (t === 'light') activateLightMode()
}</script><meta name="generator" content="Hexo 5.0.0"></head><body><div id="mobile-sidebar"><div id="menu_mask"></div><div id="mobile-sidebar-menus"><div class="mobile_author_icon"><img class="avatar-img" src="/null" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="mobile_post_data"><div class="mobile_data_item is-center"><div class="mobile_data_link"><a href="/archives/"><div class="headline">文章</div><div class="length_num">37</div></a></div></div><div class="mobile_data_item is-center">      <div class="mobile_data_link"><a href="/tags/"><div class="headline">标签</div><div class="length_num">20</div></a></div></div><div class="mobile_data_item is-center">     <div class="mobile_data_link"><a href="/categories/"><div class="headline">分类</div><div class="length_num">12</div></a></div></div></div><hr/></div></div><div id="body-wrap"><div id="sidebar"><i class="fas fa-arrow-right on" id="toggle-sidebar"></i><div class="sidebar-toc"><div class="sidebar-toc__title">目录</div><div class="sidebar-toc__progress"><span class="progress-notice">你已经读了</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar">     </div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#HTTPD-Linux%EF%BC%88Apache%EF%BC%89Httpd%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%AE%89%E8%A3%85%EF%BC%8C%E5%90%AF%E5%8A%A8%E5%8F%8Ahttpd-conf%E9%85%8D%E7%BD%AE%E8%AF%A6%E8%A7%A3"><span class="toc-number">1.</span> <span class="toc-text">[HTTPD] Linux（Apache）Httpd服务器安装，启动及httpd.conf配置详解</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1%E3%80%81Listen%E6%8C%87%E4%BB%A4-%E5%8F%8A-PidFile-%E6%8C%87%E4%BB%A4"><span class="toc-number">1.0.1.</span> <span class="toc-text">1、Listen指令 及 PidFile 指令</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%E3%80%81ServerRoot%E6%8C%87%E4%BB%A4"><span class="toc-number">1.0.2.</span> <span class="toc-text">2、ServerRoot指令</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3%E3%80%81DocumentRoot-%E6%8C%87%E4%BB%A4%E5%8F%8A%E6%A0%B9%E7%9B%AE%E5%BD%95%E9%A1%B5%E9%9D%A2%E8%AE%BF%E9%97%AE%E5%B1%9E%E6%80%A7"><span class="toc-number">1.0.3.</span> <span class="toc-text">3、DocumentRoot 指令及根目录页面访问属性</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4%E3%80%81DirectoryIndex%E6%8C%87%E4%BB%A4"><span class="toc-number">1.0.4.</span> <span class="toc-text">4、DirectoryIndex指令</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5%E3%80%81Keepalive%E6%8C%87%E4%BB%A4"><span class="toc-number">1.0.5.</span> <span class="toc-text">5、Keepalive指令</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6%E3%80%81DSO-%E5%8A%A8%E6%80%81%E5%85%B1%E4%BA%AB%E5%BA%93%E5%8A%A0%E8%BD%BD%E6%8C%87%E4%BB%A4"><span class="toc-number">1.0.6.</span> <span class="toc-text">6、DSO 动态共享库加载指令</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7%E3%80%81MPM%E5%A4%9A%E9%81%93%E5%A4%84%E7%90%86%E6%A8%A1%E5%9D%97%E9%85%8D%E7%BD%AE%E6%8C%87%E4%BB%A4-%E5%8F%8A-Include-%E6%8C%87%E4%BB%A4"><span class="toc-number">1.0.7.</span> <span class="toc-text">7、MPM多道处理模块配置指令 及  Include 指令</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8%E3%80%81ServerName%EF%BC%8CServerAdmin%E5%8F%8AServerAlias"><span class="toc-number">1.0.8.</span> <span class="toc-text">8、ServerName，ServerAdmin及ServerAlias</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#9%E3%80%81Userdir%E6%8C%87%E4%BB%A4%EF%BC%8C%E9%85%8D%E7%BD%AE%E7%94%A8%E6%88%B7%E7%9B%AE%E5%BD%95"><span class="toc-number">1.0.9.</span> <span class="toc-text">9、Userdir指令，配置用户目录</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#10%E3%80%81ScriptAlias-%E6%8C%87%E4%BB%A4%EF%BC%8C%E9%85%8D%E7%BD%AE%E8%84%9A%E6%9C%AC%E6%89%A7%E8%A1%8C%E7%9B%AE%E5%BD%95"><span class="toc-number">1.0.10.</span> <span class="toc-text">10、ScriptAlias 指令，配置脚本执行目录</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#11%E3%80%81VirtualHost%E6%8C%87%E4%BB%A4-%EF%BC%8C%E8%99%9A%E6%8B%9F%E4%B8%BB%E6%9C%BA%E9%85%8D%E7%BD%AE"><span class="toc-number">1.0.11.</span> <span class="toc-text">11、VirtualHost指令 ，虚拟主机配置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#12%E3%80%81ErrorLog-%E4%B8%8E-LogFormat-%E6%8C%87%E4%BB%A4%EF%BC%8C%E5%AE%9A%E4%B9%89web%E8%AE%BF%E9%97%AE-Log%E6%97%A5%E5%BF%97"><span class="toc-number">1.0.12.</span> <span class="toc-text">12、ErrorLog 与 LogFormat 指令，定义web访问 Log日志</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#13%E3%80%81httpd%E7%BD%91%E9%A1%B5%E8%AE%A4%E8%AF%81"><span class="toc-number">1.0.13.</span> <span class="toc-text">13、httpd网页认证</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#14%E3%80%81-%E6%8C%87%E4%BB%A4-%EF%BC%8CSetHandler-%E6%8C%87%E4%BB%A4-%EF%BC%8C%E9%85%8D%E7%BD%AE%E4%B8%BB%E9%A1%B5stauts-%E9%A1%B5%E9%9D%A2"><span class="toc-number">1.0.14.</span> <span class="toc-text">14、 指令 ，SetHandler 指令 ，配置主页stauts 页面</span></a></li></ol></li></ol></li></ol></div></div></div><header class="post-bg" id="page-header"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">MysticalYcc</a></span><span id="menus"><span class="close" id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></span></span></nav><div id="post-info"><div id="post-title"><div class="posttitle">HTTPD</div></div><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2018-08-15T16:00:00.000Z" title="发表于 2018-08-16 00:00:00">2018-08-16</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2020-09-03T07:20:23.000Z" title="更新于 2020-09-03 15:20:23">2020-09-03</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E6%9C%8D%E5%8A%A1%E5%99%A8/">服务器</a></span></div><div class="meta-secondline"> <span class="post-meta-separator">|</span><span class="post-meta-pv-cv"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"></span></span></div></div></div></header><main class="layout_post" id="content-inner"><article id="post"><div class="post-content" id="article-container"><h1 id="HTTPD-Linux（Apache）Httpd服务器安装，启动及httpd-conf配置详解"><a href="#HTTPD-Linux（Apache）Httpd服务器安装，启动及httpd-conf配置详解" class="headerlink" title="[HTTPD] Linux（Apache）Httpd服务器安装，启动及httpd.conf配置详解"></a>[HTTPD] Linux（Apache）Httpd服务器安装，启动及httpd.conf配置详解</h1><p><strong>Apache HTTP Server</strong></p>
<ul>
<li>HTTPD特性及功能</li>
</ul>
<p>Apache支持许多特性，大部分通过编译的模块实现，这些特性从服务器端的编程语言支持到身份认证方案。通用的语言接口支持Perl，Python，Tcl 和 PHP；流行的认证模块包括mod_access，mod_auth和mod_digest；其他的有SSL和TLS支持（mod_ssl），代理服务器（proxy）模块，很有用的URL重写（由mod_rewrite实现），定制日志文件（mod_log_config），以及过滤支持（mod_include和mod_ext_filter）等。主要特性如下：</p>
<p>​    高度模块化设计： core + modules</p>
<p>​    支持DSO：Dynamic Shared Object ，动态共享库</p>
<p>​    支持MPM模块：Multipath Processing Modules，多道处理模块 。</p>
<p>同时支持以下功能：虚拟主机 virtual host ；CGI：Common Gateway Interface，通用网关接口；丰富的用户认证机制：basic；digest；用户站点等。</p>
<ul>
<li>MPM包含的机制</li>
</ul>
<p>prefork机制：预先生成进程，服务器启动时会生产多个进程，并且每一个进程处理一个请求，比较稳定，任何一个进程崩溃了都不会影响到其他的进程 。如：select（）函数</p>
<p>worker机制：这是一种基于线程来工作，服务器启动时生成多个进程，每一个进程要生成多个线程，一个线程用来处理一个请求</p>
<p>event机制：基于事件驱动机制来工作的，这种机制可以使用一个进程来响应多个请求。它的并发能力是最强的。它在httpd-2.4以后得到支持。如event-driven ——事件驱动</p>
<p><strong>Httpd yum安装与编译安装</strong></p>
<hr>
<p><strong>1）Installing on CentOS6.x ,  yum源安装</strong>     </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># yum install httpd -y   安装    </span></span><br><span class="line"><span class="comment"># chkconfig --add httpd     加入启动服务    </span></span><br><span class="line"><span class="comment"># chkconfig httpd on    默认启动级别自启动    </span></span><br><span class="line"><span class="comment"># service httpd start    启动httpd服务</span></span><br></pre></td></tr></table></figure>



<ul>
<li>httpd相关配置文件：</li>
</ul>
<p>主配置文件：/etc/httpd/conf/httd.conf ，这个是httpd最主要的配置文档</p>
<p>扩展配置文件：/etc/httpd/conf.d/*.conf ，这个是httpd的额外配置文档</p>
<p>文档根目录： /var/www/html ，这个是apache 首页的文档目录 ，即输入<a target="_blank" rel="noopener" href="http://127.0.0.1/">http://127.0.0.1</a>  显示页面所在的目录</p>
<p>服务脚本：/etc/rc.d/init.d/httpd </p>
<p>错误目录：/var/www/error  ，服务器设定错误，请求的资源错误或浏览器访问出现错误等错误文件的存储目录</p>
<p>CGI目录： /var/www/cgi-bin/   ，预设为CGI运行脚本的存储目录</p>
<p>日志目录：/var/log/httpd  ，client端登录httpd时，记录的登录日志等信息存储目录</p>
<p>脚本配置文件： /etc/sysconfig/httpd</p>
<p>Listen端口：80/tcp  ,443/tcp</p>
<p>命令执行文件：/usr/sbin/apachectl ，/usr/sbin/httpd，/usr/bin/htpasswd</p>
<p>PID文件：/var/run/httpd/httpd.pid</p>
<ul>
<li>Apache相关命令及参数</li>
</ul>
<p># httpd  [  -d serverroot ] [ -f config ]  [ -k start|restart|graceful|stop|graceful-stop ]  ，用以启动、关闭和重新启动Web服务器进程  </p>
<p>​    -f &lt;设定文件&gt;  ：指定配置文件</p>
<p>​    -d &lt;服务器根目录&gt;： 指定服务器的根目录</p>
<p>​    -l ：显示服务器编译时所包含的模块</p>
<p>​    -t ：测试配置文件的语法是否正确</p>
<p>​    -M ：显示所有httpd 加载的模块</p>
<p># apachctl  [ httpd-argument ]   ，apachectl与httpd命令选项类似，不同之处可直接与下列项组合：       </p>
<p>​    fullstatus：显示服务器完整的状态信息；</p>
<p>​    graceful：重新启动Apache服务器，但不会中断原有的连接；</p>
<p>​    help：显示帮助信息；</p>
<p>​    restart：重新启动Apache服务器；</p>
<p>​    start：启动Apache服务器；</p>
<p>​    status：显示服务器摘要的状态信息；</p>
<p>​    stop：停止Apache服务器。</p>
<p># htpasswd[-cimBdpsDv]  passwordfile username，用于创建和更新储存用户名、域和用户基本认证的密码文件。        </p>
<p>​    -c：创建一个加密文件；只在第一次添加用户时使用</p>
<p>​    -n：不更新加密文件，只将加密后的用户名密码显示在屏幕上；</p>
<p>​    -m：默认采用MD5算法对密码进行加密；</p>
<p>​    -s：采用SHA算法对密码进行加密；</p>
<p>​    -b：在命令行中一并输入用户名和密码而不是根据提示输入密码；</p>
<p>​    -D：删除指定的用户。</p>
<ul>
<li>实现httpd启动、关闭、重启方法</li>
</ul>
<p># service httpd stop | start | restart</p>
<p># httpd -k stop | start | restart | graceful  </p>
<p># apachectl stop | start | restart | graceful    生产环境中重启httpd服务，建议使用apachectl命令，使用graceful 选项</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line">[root@VM ~]<span class="comment"># yum install httpd -y</span></span><br><span class="line">Dependency Installed:         <span class="comment"># 自动解决依赖关系，依赖apr 和 apr-util      </span></span><br><span class="line">  apr.x86_64 0:1.3.9-5.el6_9.1                        apr-util.x86_64 0:1.3.9-3.el6_0.1                      </span><br><span class="line">  apr-util-ldap.x86_64 0:1.3.9-3.el6_0.1               httpd-tools.x86_64 0:2.2.15-69.el6.centos              </span><br><span class="line">  mailcap.noarch 0:2.1.31-2.el6                       </span><br><span class="line"></span><br><span class="line">Complete!</span><br><span class="line"></span><br><span class="line">[root@VM ~]<span class="comment"># rpm -ql httpd    # 查看httpd安装列表</span></span><br><span class="line">/etc/httpd</span><br><span class="line">/etc/httpd/conf</span><br><span class="line">/etc/httpd/conf.d</span><br><span class="line">/etc/httpd/conf/httpd.conf</span><br><span class="line">/etc/httpd/run</span><br><span class="line">/etc/rc.d/init.d/httpd</span><br><span class="line">/etc/sysconfig/httpd</span><br><span class="line">/usr/sbin/apachectl</span><br><span class="line">/usr/sbin/htcacheclean</span><br><span class="line">/usr/sbin/httpd</span><br><span class="line">/usr/sbin/httpd.event</span><br><span class="line">/usr/sbin/httpd.worker</span><br><span class="line">/var/run/httpd</span><br><span class="line">/var/www/cgi-bin</span><br><span class="line">/var/www/html</span><br><span class="line"></span><br><span class="line">[root@VM ~]<span class="comment"># chkconfig --add httpd</span></span><br><span class="line">[root@VM ~]<span class="comment"># chkconfig httpd on</span></span><br><span class="line">[root@VM ~]<span class="comment"># service httpd start        # 启动httpd服务</span></span><br><span class="line">Starting httpd:                                            [  OK  ]</span><br><span class="line"></span><br><span class="line">[root@VM ~]<span class="comment"># ss -tunl | grep 80    # 验证服务启动正常与否</span></span><br><span class="line">tcp    LISTEN     0      128               :::80              :::*   </span><br><span class="line"></span><br><span class="line">[root@VM ~]<span class="comment"># httpd  -v   # 查看httpd 版本</span></span><br><span class="line">Server version: Apache/2.2.15 (Unix)</span><br><span class="line"></span><br><span class="line">[root@VM ~]<span class="comment"># httpd -t   # 验证httpd配置文件语法是否正确</span></span><br><span class="line">Syntax OK</span><br><span class="line"></span><br><span class="line">[root@VM ~]<span class="comment"># httpd -l   # 查看httpd加载的模块</span></span><br><span class="line">Compiled <span class="keyword">in</span> modules:</span><br><span class="line">  core.c</span><br><span class="line">  prefork.c</span><br><span class="line">  http_core.c</span><br><span class="line">  mod_so.c</span><br><span class="line"></span><br><span class="line">[root@VM ~]<span class="comment"># httpd -k start    # httpd 启动</span></span><br><span class="line">[root@VM  ~]<span class="comment"># ss -tunl</span></span><br><span class="line">Netid  State      Recv-Q Send-Q                    Local Address:Port       </span><br><span class="line">tcp    LISTEN     0      128                                  :::80    </span><br><span class="line"></span><br><span class="line">[root@VM ~]<span class="comment"># httpd -k stop</span></span><br><span class="line">[root@VM ~]<span class="comment"># ss -tunl | grep 80  # 验证httpd被关闭</span></span><br><span class="line"></span><br><span class="line">[root@VM ~]<span class="comment"># apachectl start    # 启动httpd服务</span></span><br><span class="line">httpd (pid 3545) already running</span><br><span class="line"></span><br><span class="line">[root@VM ~]<span class="comment"># apachectl graceful  #重启httpd服务，但不中断原有连接</span></span><br></pre></td></tr></table></figure>





<p><strong>2）Installing from source , 源码安装</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">apr ，apr-util ，gcc ，gcc-c++ ，pcre 相关环境准备 </span><br><span class="line">Download the latest release form http://httpd.apache.org/download.cgi  下载         </span><br><span class="line"><span class="comment"># gzip httpd-NN.tar.gz    提取         </span></span><br><span class="line"><span class="comment"># tar xvf httpd-NN.tar</span></span><br><span class="line"><span class="comment"># cd httpd-NN</span></span><br><span class="line"><span class="comment"># ./configure --prefix=PREFIX ‘--other-variable ’ 配置         </span></span><br><span class="line"><span class="comment"># make &amp;&amp; make install    编译安装     </span></span><br><span class="line"><span class="comment"># vim PREFIX/conf/httpd.conf    预设功能     </span></span><br><span class="line"><span class="comment"># PREFIX/bin/apachectl -k start    测试         </span></span><br><span class="line"><span class="comment"># PREFIX/bin/apachectl -k stop</span></span><br></pre></td></tr></table></figure>



<ul>
<li>编译安装Apache需要以下需求</li>
</ul>
<p>APR和APR-Util：此库是必需的，确保系统上已安装APR和APR-Util 。<a target="_blank" rel="noopener" href="http://apr.apache.org/download.cgi">http://apr.apache.org/download.cgi</a>   </p>
<p>PCRE：此库是必需的，但不再与httpd捆绑在一起，建议源码安装 # yum install pcre pcre-devel -y</p>
<p>GCC：确保安装了ANSI-C编译器 gcc 和 gcc-c++</p>
<p>Perl 5：该项为可选项，对于某些支持脚本，如apsx或dbmmanage（用Perl编写），需要Perl 5解释器</p>
<ul>
<li>./configure常用选项及功能介绍</li>
</ul>
<p># ./configure –help ：查看相关命令帮助，查看相关支持的选项参数及功能</p>
<p>​    –prefix=PREFIX ：指定默认安装目录</p>
<p>​    –bindir=DIR：指定二进制可执行文件安装目录</p>
<p>​    –sbindir=DIR：指定可执行文件安装目录</p>
<p>​    –includedir=DIR：指定头文件安装目录 </p>
<p>​    –enable-so   ：   启用DSO动态加载模块支持，需要什么功能模块可动态加载</p>
<p>​    –enable–ssl  ：SSL/TLS support (mod_ssl)</p>
<p>​    –enable-cgi   ：支持CGI脚本功能</p>
<p>​    –enable-rewrite ： 启用网页地址重写功能，实现伪静态   </p>
<p>​    –with-z=DIR：安装zlib库</p>
<p>​    –with-pcre=DIR ：使用扩展的pcre lib库</p>
<p>​    –with-apr=DIR ：指向apr安装路径</p>
<p>​    –with-apr-util=DIR ：指向apr-util 安装路径</p>
<p>​    –enable-modules=most ：指定安装DSO动态库用来通信</p>
<p>​    –with-mpm=prefork|worker|event ：指定服务器默认支持的一种MPM模块</p>
<p>​    –enable-mpms-shared=all  ：当前平台选择MPM加载动态模块并以DSO动态库方式进行创建</p>
<p>configure的各项参数及功能介绍，可参照官方文档<a target="_blank" rel="noopener" href="https://httpd.apache.org/docs/2.4/en/programs/configure.html">https://httpd.apache.org/docs/2.4/en/programs/configure.html</a>   </p>
<ul>
<li>多模处理模块MPM</li>
</ul>
<p>默认MPM：在unix平台端，支持prefork 、worker、event模块</p>
<p>构建MPM为静态模块： –with-mpm=prefork|event|worker  ，如果要改变 MPM，必须重新构建。</p>
<p>构建MPM为动态模块： –enable-mpms-shared=all  ，所有此平台支持的 MPM 模块都会被安装 ，然后出现在生成的服务器配置文件中。 编辑 LoadModule 指令内容可以选择不同的 MPM模块。  </p>
<ul>
<li>实现httpd启动、关闭、重启方法</li>
</ul>
<p># /usr/local/apache/bin/apachectl -f /etc/httpd/httpd.conf  ：启动httpd进程，并指定启动配置文件</p>
<p># kill -TERM|USR1  <code>cat /usr/local/apache/logs/httpd.pid</code>    ：关闭httpd进程，通过kill命令向httpd进程发送信令</p>
<p># apachectl stop | start | restart | graceful ：apachectl命令实现httpd进程停止、启动、重启等功能</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 下载httpd ，apr ，apr-util源码包</span></span><br><span class="line">[root@VM ~]<span class="comment"># wget http://mirror.olnevhost.net/pub/apache//apr/apr-1.6.3.tar.gz    </span></span><br><span class="line">[root@VM ~]<span class="comment"># wget http://mirror.olnevhost.net/pub/apache//apr/apr-util-1.6.1.tar.gz     </span></span><br><span class="line">[root@VM ~]<span class="comment"># wget http://mirror.cc.columbia.edu/pub/software/apache//httpd/httpd-2.4.34.tar.gz  </span></span><br><span class="line"></span><br><span class="line">[root@VM ~]<span class="comment"># ls</span></span><br><span class="line">anaconda-ks.cfg   apr-util-1.6.1.tar.gz  install.log</span><br><span class="line">apr-1.6.3.tar.gz  httpd-2.4.34.tar.gz    install.log.syslog</span><br><span class="line"></span><br><span class="line">[root@VM ~]<span class="comment"># tar xf apr-1.6.3.tar.gz      # 解压文件</span></span><br><span class="line">[root@VM ~]<span class="comment"># tar xf apr-util-1.6.1.tar.gz </span></span><br><span class="line">[root@VM ~]<span class="comment"># tar xf httpd-2.4.34.tar.gz </span></span><br><span class="line"></span><br><span class="line">[root@VM ~]<span class="comment"># yum install gcc gcc-c++ pcre pcre-devel   # 安装httpd依赖需求</span></span><br><span class="line">[root@VM ~]<span class="comment"># yum groupinstall &quot;Development tools&quot;      # 安装包组开发工具</span></span><br><span class="line">[root@VM ~]<span class="comment"># yum groupinstall &quot;Server Platform Development&quot;   # 安装包组服务开发环境</span></span><br><span class="line"></span><br><span class="line">[root@VM ~]<span class="comment"># cd apr-1.6.3    # 编译安装apr</span></span><br><span class="line">[root@VM apr-1.6.3]<span class="comment"># ./configure --prefix=/usr/local/apr</span></span><br><span class="line">[root@VM apr-1.6.3]<span class="comment"># make &amp;&amp; make install </span></span><br><span class="line"></span><br><span class="line">[root@VM ~]<span class="comment"># cd apr-util-1.6.1  # 编译安装apr-util</span></span><br><span class="line">[root@VM apr-util-1.6.1]<span class="comment"># ./configure --prefix=/usr/local/apr-util --with-apr=/usr/local/apr/</span></span><br><span class="line">[root@VM apr-util-1.6.1]<span class="comment"># make &amp;&amp; make install </span></span><br><span class="line"></span><br><span class="line">[root@VM ~]<span class="comment"># cd httpd-2.4.34  # 编译安装httpd</span></span><br><span class="line">[root@VM httpd-2.4.34]<span class="comment"># ./configure --prefix=/usr/local/apache --sysconfdir=/etc/httpd --enable-so --enable--ssl --enable-cgi --enable-rewrite </span></span><br><span class="line">--with-zlib --with-pcre --with-apr=/usr/<span class="built_in">local</span>/apr --with-apr-util=/usr/<span class="built_in">local</span>/apr-util/   --<span class="built_in">enable</span>-modeles=most --<span class="built_in">enable</span>-mpms-shared=all --with-mpm=event   </span><br><span class="line">[root@VM httpd-2.4.34]<span class="comment"># make &amp;&amp; make install</span></span><br><span class="line"></span><br><span class="line">[root@VM bin]<span class="comment"># vi /etc/profile.d/http.sh    # 配置环境变量</span></span><br><span class="line"><span class="built_in">export</span> PATH=/usr/<span class="built_in">local</span>/apache/bin:<span class="variable">$PATH</span></span><br><span class="line">[root@VM bin]<span class="comment"># . /etc/profile.d/http.sh   #使能环境变量生效</span></span><br><span class="line">[root@VM bin]<span class="comment"># echo $PATH</span></span><br><span class="line">/usr/<span class="built_in">local</span>/apache/bin:/usr/<span class="built_in">local</span>/sbin:/usr/<span class="built_in">local</span>/bin:/sbin:/bin:/usr/sbin:/usr/bin:/root/bin</span><br><span class="line"></span><br><span class="line">[root@VM apache]<span class="comment"># ln -sv /usr/local/apache/include/ /usr/include/httpd  # 配置httpd include头文件</span></span><br><span class="line">`/usr/include/httpd<span class="string">&#x27; -&gt; `/usr/local/apache/include/&#x27;</span></span><br><span class="line">[root@VM apache]<span class="comment"># ls -l  /usr/include/ | grep httpd  </span></span><br><span class="line">lrwxrwxrwx   1 root root     26 Aug 11 20:35 httpd -&gt; /usr/<span class="built_in">local</span>/apache/include/</span><br><span class="line"></span><br><span class="line">[root@VM apache]<span class="comment"># vi /etc/man.config  # 配置httpd man帮助文件</span></span><br><span class="line">MANPATH /usr/<span class="built_in">local</span>/apache/man  <span class="comment"># 添加该行，httpd man文件地址</span></span><br><span class="line"></span><br><span class="line">[root@VM apache]<span class="comment"># apachectl start    # 启动httpd服务</span></span><br><span class="line">[root@VM apache]<span class="comment"># ss -tunl | grep 80 # 验证80端口是否处于侦听状态           </span></span><br><span class="line">Netid State      Recv-Q Send-Q                                              </span><br><span class="line">tcp   LISTEN     0      128                                                             </span><br><span class="line">[root@VM ~]<span class="comment"># kill -TERM `cat /usr/local/apache/logs/httpd.pid`   #停止httpd进程</span></span><br><span class="line"></span><br><span class="line">[root@VM ~]<span class="comment"># apachectl -f /etc/httpd/httpd.conf     #启动httpd进程，并指定httpd启动配置文件</span></span><br></pre></td></tr></table></figure>





<p><strong>Apache配置文件介绍</strong></p>
<hr>
<ul>
<li>主配置文件</li>
</ul>
<p>通过将指令放在纯文本配置文件中来配置Apache HTTP Server 。通常调用主配置文件 httpd.conf ，此外，可以使用该Include 指令添加其他配置文件，并且可以使用通配符包含许多配置文件。    </p>
<p>​    <img src="https://s1.51cto.com/images/20180813/1534146353499477.png?x-oss-process=image/watermark,size_16,text_QDUxQ1RP5Y2a5a6i,color_FFFFFF,t_100,g_se,x_10,y_10,shadow_90,type_ZmFuZ3poZW5naGVpdGk=" alt="image.png"></p>
<p>​    <img src="https://s1.51cto.com/images/20180812/1534052053897079.png?x-oss-process=image/watermark,size_16,text_QDUxQ1RP5Y2a5a6i,color_FFFFFF,t_100,g_se,x_10,y_10,shadow_90,type_ZmFuZ3poZW5naGVpdGk=" alt="image.png"></p>
<ul>
<li>配置文件的语法</li>
</ul>
<p>httpd配置文件每行包含一个指令。反斜杠“\”可以用作一行上的最后一个字符，表示该指令继续到下一行。反斜杠和行尾之间不能有其他字符或空格。</p>
<p>指令的参数由空格分隔。如果参数包含空格，则必须将该参数括在引号中</p>
<p>配置文件中的指令不区分大小写，但指令的参数通常区分大小写。以“＃”开头的行被视为注释行，可被忽略。</p>
<p>可使用apachectl configtest 或 apachectl -t命令行检查配置文件中的语法错误，而无需启动服务器。</p>
<ul>
<li>模块化设计 </li>
</ul>
<p>httpd是一个模块化服务器，只包含最基本的核心功能；可以通过加载到httpd模块的方式提供扩展功能。 包含指令<IfModule> 和 <LoadModule>    </p>
<p>​    <img src="https://s1.51cto.com/images/20180813/1534146310897456.png?x-oss-process=image/watermark,size_16,text_QDUxQ1RP5Y2a5a6i,color_FFFFFF,t_100,g_se,x_10,y_10,shadow_90,type_ZmFuZ3poZW5naGVpdGk=" alt="image.png">    </p>
<p>​    <img src="https://s1.51cto.com/images/20180813/1534146530722347.png?x-oss-process=image/watermark,size_16,text_QDUxQ1RP5Y2a5a6i,color_FFFFFF,t_100,g_se,x_10,y_10,shadow_90,type_ZmFuZ3poZW5naGVpdGk=" alt="image.png"></p>
<ul>
<li>指令范围</li>
</ul>
<p>通过配置文件中的指令来限定作用范围，包含指令<Directory>，<DirectoryMatch>，<Files>，<FilesMatch>，<Location>，<LocationMatch>  ，<Virtualhost>等</p>
<p>httpd可以同时为许多不同的网站提供服务。这称为虚拟主机。指令也可以通过将它们放在<VirtualHost> 部分中来限定范围。</p>
<p>​    <img src="https://s1.51cto.com/images/20180813/1534146572732446.png?x-oss-process=image/watermark,size_16,text_QDUxQ1RP5Y2a5a6i,color_FFFFFF,t_100,g_se,x_10,y_10,shadow_90,type_ZmFuZ3poZW5naGVpdGk=" alt="image.png"></p>
<p>​    <img src="https://s1.51cto.com/images/20180813/1534146627994201.png?x-oss-process=image/watermark,size_16,text_QDUxQ1RP5Y2a5a6i,color_FFFFFF,t_100,g_se,x_10,y_10,shadow_90,type_ZmFuZ3poZW5naGVpdGk=" alt="image.png"></p>
<p>​    <img src="https://s1.51cto.com/images/20180813/1534168379486262.png?x-oss-process=image/watermark,size_16,text_QDUxQ1RP5Y2a5a6i,color_FFFFFF,t_100,g_se,x_10,y_10,shadow_90,type_ZmFuZ3poZW5naGVpdGk=" alt="image.png"></p>
<ul>
<li>.htaccess 文件</li>
</ul>
<p>httpd允许通过放置在Web树中的特殊文件来分散管理配置。通常会调用特殊文件.htaccess，这些.htaccess文件遵循与主配置文件相同的语法。包括指令<AccessFileName> <Allowoveride></p>
<p>​    <img src="https://s1.51cto.com/images/20180812/1534053366513152.png?x-oss-process=image/watermark,size_16,text_QDUxQ1RP5Y2a5a6i,color_FFFFFF,t_100,g_se,x_10,y_10,shadow_90,type_ZmFuZ3poZW5naGVpdGk=" alt="image.png"></p>
<p>注：绝大多数配置修改后，可以通过 service httpd reload 来生效；如果修改了监听的地址或端口，必须重启服务才能生效</p>
<p><strong>以httpd.2.4 版本为例，Httpd.conf 配置文件相关指令详解</strong></p>
<hr>
<h3 id="1、Listen指令-及-PidFile-指令"><a href="#1、Listen指令-及-PidFile-指令" class="headerlink" title="1、Listen指令 及 PidFile 指令"></a>1、Listen指令 及 PidFile 指令</h3><p>Listen指令是为了设置监听套接字 。PidFile指令是为了指定httpd的PidFile文件。</p>
<p>​    语法：Listen [IP-address:]portnumber [protocol]</p>
<p>​    语法2：PidFile filename   </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Listen 80      <span class="comment"># 设置侦听端口  </span></span><br><span class="line">Listen 127.0.0.1:80    <span class="comment"># 设置侦听ip 及 端口     </span></span><br><span class="line">Listen 192.168.4.150:8000    </span><br><span class="line">Listen  192.168.4.150:8443  https    <span class="comment"># 侦听 ip 192.168.4.150 8443端口 https 协议</span></span><br><span class="line"></span><br><span class="line">&lt;IfModule !mpm_netware_module&gt;</span><br><span class="line">    PidFile <span class="string">&quot;/var/run/httpd/httpd.pid&quot;</span>    <span class="comment"># 指定PidFile文件为 /var/run/httpd/httpd.pid </span></span><br><span class="line">&lt;/IfModule&gt;</span><br></pre></td></tr></table></figure>



<h3 id="2、ServerRoot指令"><a href="#2、ServerRoot指令" class="headerlink" title="2、ServerRoot指令"></a>2、ServerRoot指令</h3><p>该指令设置httpd的安装位置，编译安装时可通过”–prefix”选项指定，如–prefix=/usr/local/apache  ；不建议安装完成后，变更不同的路径 ：因为在配置文件中，部分指令路径是依赖该httpd的根路径的相对路径。</p>
<p>​    语法：ServerRoot directory-path</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ServerRoot <span class="string">&quot;/usr/local/apache&quot;</span>  <span class="comment"># httpd 安装目录</span></span><br></pre></td></tr></table></figure>



<h3 id="3、DocumentRoot-指令及根目录页面访问属性"><a href="#3、DocumentRoot-指令及根目录页面访问属性" class="headerlink" title="3、DocumentRoot 指令及根目录页面访问属性"></a>3、DocumentRoot 指令及根目录页面访问属性</h3><p>指定server站点的根目录。使用rpm包安装的httpd的DocumentRoot默认值为”/var/www/html”；编译安装的httpd时，其DocumentRoot默认为”$ServerRoot/htdocs”</p>
<p>​    语法：DocumentRoot directory-path</p>
<ul>
<li>Options指令选项：</li>
</ul>
<p>​    Indexes：缺少指定的页面时，允许将目录中的所有文件列举出来；除非是提供文件下载，否则出于安全考虑，这个选项是强烈建议关闭的</p>
<p>​    FollowSymLinks ：允许跟随符号链接所指向的原始文件；出于安全考虑，这个选项建议关闭</p>
<p>​    ExecCGI：允许使用mod_cgi 模块执行CGI脚本</p>
<p>​    Includes：允许使用mod_include模块实现服务器端包含（SGI）</p>
<p>​    MultiViews：允许使用mod_negotiation实现内容协商</p>
<p>​    SymLinksIfOwnerMatch：在链接文件属主属组域原始文件属主属组相同时，允许跟随符号链接所指向的原始文件</p>
<ul>
<li>AllowOverride 指令选项：用于控制是否读取”.htaccess”配置文件。</li>
</ul>
<p>​    all：启用AllowOverride特性</p>
<p>​    none：禁用AllowOverride特性。</p>
<p>​    AuthConfig：基于用户认证时设置该值，此时将可以使用AuthGroupFile, AuthName, AuthType, AuthUserFile，Require等认证相关指令。</p>
<p>​    FileInfo： 控制文档类型时使用该值，此时将可以使用ErrorDocument, SetHandler,以及一些URL重写的指令。</p>
<p>​    Indexes：控制目录索引时使用该值，此时可以使用AddIcon, DirectoryIndex。</p>
<p>​    Limit：是否允许使用order、allow、deny指令，这三个指令已经废弃，目前还存在是为了兼容老版本。</p>
<ul>
<li>Require指令选项：实现对用户访问限制</li>
</ul>
<p>​    Require all granted  ：所有用户允许访问</p>
<p>​    Require all dined     ：所有用户禁止访问</p>
<p>​    Require  Valid-user  ：仅允许有效用户进行访问</p>
<p>​    Require user  userid [userid] <strong>…</strong>    仅允许userid用户进行访问</p>
<p>​    Require group Group-name [group-name] <strong>.**</strong>..**      仅允许Group-name组内用户进行访问</p>
<ul>
<li>Order 指令: 实现对用户的访问限制</li>
</ul>
<p>​    Order Allow，Deny      # 定义权限，先允许 ，后拒绝  ；在规则中，若二者都匹配或二者都不匹配，则以Order 命令中的第二项为准；否则，则匹配到相关项为准 </p>
<p>​    Allow  From  IP | network    # 允许的ip 或 network</p>
<p>​    Deny  From   IP | network    # 拒绝的ip 或 network       </p>
<ul>
<li>实现用户访问限制方法：以下两个选项二选一 ，不建议同时使用</li>
</ul>
<p>​    1、Require all  [ granted | dined ]     允许 或 拒绝 所有用户访问</p>
<p>​    2、通过Order 与 Allow 或Deny 的指令组合来实现。    </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">DocumentRoot <span class="string">&quot;/usr/local/apache/htdocs&quot;</span>    </span><br><span class="line"><span class="comment">#指定server 站点的根目录 ，可改变该路径地址，实现把其他目录作为server根目录</span></span><br><span class="line"></span><br><span class="line">&lt;Directory <span class="string">&quot;/usr/local/apache/htdocs&quot;</span>&gt;    <span class="comment">#  定义目录属性</span></span><br><span class="line">    Options Indexes FollowSymLinks    </span><br><span class="line">    <span class="comment"># 配置目录中可用的功能，包括Indexes ，FollowSymLinks ，None ，All ，ExecCGI等 </span></span><br><span class="line">    </span><br><span class="line">    AllowOverride None    <span class="comment"># 不允许存在于.htaccess文件中的指令类型</span></span><br><span class="line">   </span><br><span class="line">    Require all granted | denied    <span class="comment"># 允许或拒绝 所有用户访问</span></span><br><span class="line"> </span><br><span class="line">    Order allow,deny    <span class="comment"># 先允许，在禁止 顺序匹配 ，定义限制用户</span></span><br><span class="line">    Allow from IP | network </span><br><span class="line">    Deny from IP | network </span><br><span class="line"></span><br><span class="line">&lt;/Directory&gt;</span><br></pre></td></tr></table></figure>





<h3 id="4、DirectoryIndex指令"><a href="#4、DirectoryIndex指令" class="headerlink" title="4、DirectoryIndex指令"></a>4、DirectoryIndex指令</h3><p>httpd服务器端将DorectoryIndex指令所指定的文件响应给客户端。如访问 <a target="_blank" rel="noopener" href="http://www.itwish.cn/">http://www.itwish.cn/</a>   ，将自动把$Document下的index.html 文件内容返回给客户端 。</p>
<p>​    语法：DirectoryIndex disabled | local-url [local-url]</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;IfModule dir_module&gt;</span><br><span class="line">    DirectoryIndex index.html index.php  /cgi-bin/index.pl</span><br><span class="line">    <span class="comment">#从左至右依次查找 ，先查找index.html 文件 ，若没有就查找index.php 文件 ，再没有就查找/cgi-bin/index.pl 文件</span></span><br><span class="line"></span><br><span class="line">&lt;/IfModule&gt;</span><br></pre></td></tr></table></figure>



<h3 id="5、Keepalive指令"><a href="#5、Keepalive指令" class="headerlink" title="5、Keepalive指令"></a>5、Keepalive指令</h3><p>KeepAlive指令用于开启和关闭持久连接功能。在没有开启持久连接时，客户端每请求一个资源都需重新建立一次TCP连接，而使用了持久连接后，客户端只需在最初请求一次TCP连接，之后就可以使用同一个TCP连接发送其他的http请求；但长连接自身的缺陷是会一直占用着连接不释放，所以必须得给出一个长连接的超时时间，这个超时时间由KeepAliveTimeout指令控制；还可以通过指令MaxKeepAliveRequests控制每个长连接下的TCP连接的能接受的最大请求数。无疑，这个值应该设置的大一些，设置为0表示无限制。</p>
<p>​    语法1：KeepAlive On|Off   </p>
<p>​    语法2：KeepAliveTimeout num[ms]</p>
<p>​    语法3：MaxKeepAliveRequests number</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@VM httpd]<span class="comment"># vi /etc/httpd/httpd.conf </span></span><br><span class="line"><span class="comment"># Various default settings</span></span><br><span class="line">Include /etc/httpd/extra/httpd-default.conf    <span class="comment"># 启用扩展配置文件httpd-default.conf </span></span><br><span class="line"></span><br><span class="line">[root@VM extra]<span class="comment"># vi httpd-default.conf </span></span><br><span class="line">KeepAlive On   <span class="comment"># 启用HTTP持久连接功能</span></span><br><span class="line">KeepAliveTimeout  5     <span class="comment"># 关闭连接之前等待后续请求的秒数 ，通过添加ms的后缀，表示可设置为毫秒</span></span><br><span class="line">MaxKeepAliveRequests 50    <span class="comment"># 限制打开时每个连接允许的请求数，若为0 ，则不限制</span></span><br></pre></td></tr></table></figure>



<h3 id="6、DSO-动态共享库加载指令"><a href="#6、DSO-动态共享库加载指令" class="headerlink" title="6、DSO 动态共享库加载指令"></a>6、DSO 动态共享库加载指令</h3><p>Apache HTTP Server是一个模块化程序，管理员可以通过加载不同的模块组来选择要包含在服务器中的功能。在编译安装时，通过选项–enable-so 来加载DSO（动态共享对象）功能。通过LoadModule命令来实现关闭或开启功能模块 。</p>
<p>​    语法：LoadModule status_module “modules/mod_status.so”</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[root@vm ~]<span class="comment"># vi /etc/httpd/httpd.conf </span></span><br><span class="line"><span class="comment">#LoadModule mpm_event_module modules/mod_mpm_event.so</span></span><br><span class="line">LoadModule mpm_prefork_module modules/mod_mpm_prefork.so</span><br><span class="line"><span class="comment">#LoadModule mpm_worker_module modules/mod_mpm_worker.so</span></span><br><span class="line">LoadModule authn_file_module modules/mod_authn_file.so</span><br><span class="line"><span class="comment">#LoadModule authn_dbm_module modules/mod_authn_dbm.so</span></span><br><span class="line"><span class="comment">#LoadModule authn_anon_module modules/mod_authn_anon.so</span></span><br><span class="line"><span class="comment">#LoadModule authn_dbd_module modules/mod_authn_dbd.so</span></span><br><span class="line"><span class="comment">#LoadModule authn_socache_module modules/mod_authn_socache.so</span></span><br><span class="line">LoadModule authn_core_module modules/mod_authn_core.so</span><br><span class="line">LoadModule authz_host_module modules/mod_authz_host.so</span><br><span class="line">LoadModule authz_groupfile_module modules/mod_authz_groupfile.so</span><br><span class="line">LoadModule authz_user_module modules/mod_authz_user.so</span><br></pre></td></tr></table></figure>



<h3 id="7、MPM多道处理模块配置指令-及-Include-指令"><a href="#7、MPM多道处理模块配置指令-及-Include-指令" class="headerlink" title="7、MPM多道处理模块配置指令 及  Include 指令"></a>7、MPM多道处理模块配置指令 及  Include 指令</h3><p>Apache HTTP 服务器 2.0 扩展此模块化设计到最基本的 web 服务器功能，它提供了可以选择的多处理模块(MPM)，可在编译时使用–with-mpm选项来决定apache的工作模式。MPM 很像其它 Apache httpd 模块，主要是区别是任何时间内必须有一个且只能有一个 MPM 模块需加载到服务器中，可用的MPM模块包括prefork ，event ，worker等。可以通过httpd -M命令列出apache的所有模块，查看相应其工作方式。</p>
<p>Include 指令是用于在httpd启动时，使用include指令来包含其他配置文件，在解析配置文件时会把主配置文件httpd.conf 与include 包含的文件进行配置合并 ，实现整体对 httpd 的配置调节。</p>
<p>​    语法：Include file-path|directory-path|wildcard   </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">[root@vm ~]<span class="comment"># vi /etc/httpd/httpd.conf </span></span><br><span class="line">    LoadModule mpm_event_module modules/mod_mpm_event.so    <span class="comment"># 手动加载的mod_mpm模块</span></span><br><span class="line">    <span class="comment">#LoadModule mpm_prefork_module modules/mod_mpm_prefork.so    # 若更改mpm_prefork或mpm_worker模块，其余两种模块行注释</span></span><br><span class="line">    <span class="comment">#LoadModule mpm_worker_module modules/mod_mpm_worker.so</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Server-pool management (MPM specific)</span></span><br><span class="line">Include /etc/httpd/extra/httpd-mpm.conf    <span class="comment"># 启动httpd-mpm.conf 扩展配置文件 </span></span><br><span class="line"></span><br><span class="line">[root@vm ~]<span class="comment"># vi /etc/httpd/extra/httpd-mpm.conf </span></span><br><span class="line"></span><br><span class="line">&lt;IfModule mpm_prefork_module&gt;</span><br><span class="line">    StartServers             5    <span class="comment"># 开机启动的工作进程数</span></span><br><span class="line">    MinSpareServers          5    <span class="comment"># 保留备用的最小工作进程数    </span></span><br><span class="line">    MaxSpareServers         10    <span class="comment"># 保留备用的最大工作进程数</span></span><br><span class="line">    MaxRequestWorkers      250    <span class="comment"># httpd启动时开启的最大工作进程数</span></span><br><span class="line">    MaxConnectionsPerChild   0    <span class="comment"># 服务器进程所服务的最大连接数，0代表不限制</span></span><br><span class="line">&lt;/IfModule&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&lt;IfModule mpm_worker_module&gt;</span><br><span class="line">    StartServers             3    <span class="comment"># 启动的子进程的个数</span></span><br><span class="line">    MinSpareThreads         75    <span class="comment"># 保留备用的最小工作线程数</span></span><br><span class="line">    MaxSpareThreads        250    <span class="comment"># 保留备用的最大工作线程数</span></span><br><span class="line">    ThreadsPerChild         25    <span class="comment"># 服务器进程的工作线程数</span></span><br><span class="line">    MaxRequestWorkers      400    <span class="comment"># 服务器最大工作线程数 </span></span><br><span class="line">    MaxConnectionsPerChild   0    <span class="comment"># 服务器的最大进程连接数 ，0代表不做限制</span></span><br><span class="line">&lt;/IfModule&gt;</span><br><span class="line"></span><br><span class="line">&lt;IfModule mpm_event_module&gt;</span><br><span class="line">    StartServers             3    <span class="comment"># 启动的子进程的个数</span></span><br><span class="line">    MinSpareThreads         75    <span class="comment"># 保留备用的最小工作线程数</span></span><br><span class="line">    MaxSpareThreads        250    <span class="comment"># 保留备用的最大工作线程数</span></span><br><span class="line">    ThreadsPerChild         25    <span class="comment"># 服务器进程的工作线程数</span></span><br><span class="line">    MaxRequestWorkers      400    <span class="comment"># 服务器最大工作线程数 </span></span><br><span class="line">    MaxConnectionsPerChild   0    <span class="comment"># 服务器的最大进程连接数 ，0代表不做限制</span></span><br><span class="line">&lt;/IfModule&gt;</span><br><span class="line">&lt;/IfModule&gt;</span><br></pre></td></tr></table></figure>



<h3 id="8、ServerName，ServerAdmin及ServerAlias"><a href="#8、ServerName，ServerAdmin及ServerAlias" class="headerlink" title="8、ServerName，ServerAdmin及ServerAlias"></a>8、ServerName，ServerAdmin及ServerAlias</h3><p>ServerName用于唯一标识提供web服务的主机名，只有在基于名称的虚拟主机中该指令才是必须的 。ServerAlias用于定义ServerName的别名。 ServerAdmin 是用于定义管理邮箱地址。</p>
<p>​    语法1：ServerName [scheme://]domain-name|ip-address[:port]   </p>
<p>​    语法2：ServerAdmin email-address|URL        </p>
<p>​    语法3：ServerAlias hostname [hostname]         </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">[root@VM httpd]<span class="comment"># vi httpd.conf </span></span><br><span class="line"><span class="comment"># ServerAdmin: Your address, where problems with the server should be</span></span><br><span class="line"><span class="comment"># e-mailed.  This address appears on some server-generated pages, such</span></span><br><span class="line"><span class="comment"># as error documents.  e.g. admin@your-domain.com</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line">ServerAdmin web@itwish.cn      <span class="comment"># 定义Server管理员邮箱地址</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># ServerName gives the name and port that the server uses to identify itself.</span></span><br><span class="line"><span class="comment"># This can often be determined automatically, but we recommend you specify</span></span><br><span class="line"><span class="comment"># it explicitly to prevent problems during startup.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># If your host doesn&#x27;t have a registered DNS name, enter its IP address here.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line">ServerName www.itwish.cn:80      <span class="comment"># 定义主机名称</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@VM httpd]<span class="comment"># vi extra/httpd-vhosts.conf </span></span><br><span class="line">&lt;VirtualHost *:80&gt;</span><br><span class="line">    ServerAdmin webmaster@itwish.cn     <span class="comment"># 定义Server管理员邮箱地址</span></span><br><span class="line">    ServerName www.itwish.cn      <span class="comment"># 定义主机名称</span></span><br><span class="line">    ServerAlias  www     <span class="comment"># 定义主机别名 </span></span><br><span class="line">&lt;/VirtualHost&gt;</span><br></pre></td></tr></table></figure>



<h3 id="9、Userdir指令，配置用户目录"><a href="#9、Userdir指令，配置用户目录" class="headerlink" title="9、Userdir指令，配置用户目录"></a>9、Userdir指令，配置用户目录</h3><p>允许每个用户使用该UserDir指令在其主目录中拥有一个网站。可通过<a target="_blank" rel="noopener" href="http://example.com/~username/">http://example.com/~username/</a> 进行访问 ，注：务必要为用户的家目录赋予运行httpd进程的用户daemon拥有执行权限 </p>
<p>​    语法：UserDir directory-filename [directory-filename] …</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">[root@VM httpd]<span class="comment"># vi /etc/httpd/httpd.conf </span></span><br><span class="line">    LoadModule authz_host_module modules/mod_authz_host.so <span class="comment"># 加载userdir 依赖的动态DSO文件 ，取消注释“#” 即可实现加载。</span></span><br><span class="line">    LoadModule authz_core_module modules/mod_authz_core.so</span><br><span class="line">    LoadModule userdir_module modules/mod_userdir.so</span><br><span class="line"></span><br><span class="line"><span class="comment"># User home directories</span></span><br><span class="line">    Include /etc/httpd/extra/httpd-userdir.conf        <span class="comment"># 包含扩展文件 httpd-userdir.conf </span></span><br><span class="line"></span><br><span class="line">[root@VM httpd]<span class="comment"># vi extra/httpd-userdir.conf </span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Required module: mod_authz_core, mod_authz_host, mod_userdir</span></span><br><span class="line"><span class="comment"># 该功能依赖DSO 动态模块 mod_authz_core，mod_authz_host, mod_userdir </span></span><br><span class="line"></span><br><span class="line">UserDir public_html <span class="comment"># 定义用户访问目录名称   </span></span><br><span class="line"><span class="comment"># public_html是用户家目录下的目录名称，所有位于此目录中的文件均可通过url http://example.com/~username进行访问</span></span><br><span class="line"></span><br><span class="line">&lt;Directory <span class="string">&quot;/home/*/public_html&quot;</span>&gt;    <span class="comment"># 定义目录页面属性</span></span><br><span class="line">    AllowOverride FileInfo AuthConfig Limit Indexes     <span class="comment"># 配置AllowOverride 指令</span></span><br><span class="line">    Options  Indexes FollowSymlinks                 <span class="comment"># 配置Options 指令</span></span><br><span class="line">    Require all granted          <span class="comment"># 配置Require 指令</span></span><br><span class="line">&lt;/Directory&gt;</span><br><span class="line"></span><br><span class="line">[root@VM httpd]<span class="comment"># useradd itwish       # 添加用户及配置密码</span></span><br><span class="line">[root@VM httpd]<span class="comment"># passwd itwish</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@VM itwish]<span class="comment"># mkdir /home/itwish/public_html   # 在用户家目录下创建Userdir 定义的目录文件 </span></span><br><span class="line">[root@VM itwishl]<span class="comment"># touch /home/itwish/public_html/&#123;a,b,c&#125;  </span></span><br><span class="line"></span><br><span class="line">[root@VM itwish]<span class="comment"># setfacl -m  u:daemon:x /home/itwish/  # 注：务必要为用户家目录配置httpd启动用户daemon的执行权限</span></span><br></pre></td></tr></table></figure>



<p>测试itwish用户的个人网站：</p>
<p>​     <img src="https://s1.51cto.com/images/20180814/1534250133265768.png?x-oss-process=image/watermark,size_16,text_QDUxQ1RP5Y2a5a6i,color_FFFFFF,t_100,g_se,x_10,y_10,shadow_90,type_ZmFuZ3poZW5naGVpdGk=" alt="image.png">   </p>
<h3 id="10、ScriptAlias-指令，配置脚本执行目录"><a href="#10、ScriptAlias-指令，配置脚本执行目录" class="headerlink" title="10、ScriptAlias 指令，配置脚本执行目录"></a>10、ScriptAlias 指令，配置脚本执行目录</h3><p>将URL映射到文件系统位置，并将目标指定为CGI脚本。例：Script Alias  “cgi-bin”  “/usr/local/apache/cgi-bin/“  表示访问 <a target="_blank" rel="noopener" href="http://www.itwish.cn/cgi-bin/test">http://www.itwish.cn/cgi-bin/test</a>  时，目录映射地址为 /usr/local/apache/cgi-bin/test </p>
<p>​    语法1：ScriptAlias [URL-path] file-path|directory-path    </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 定义/cgi-bin/ 目录映射到 /web/cgi-bin/ 目录 ，1)功能等同于2) ，注意结尾的&quot;/&quot;</span></span><br><span class="line">1）</span><br><span class="line">ScriptAlias <span class="string">&quot;/cgi-bin/&quot;</span> <span class="string">&quot;/web/cgi-bin/&quot;</span>       </span><br><span class="line">2）</span><br><span class="line">Alias <span class="string">&quot;/cgi-bin/&quot;</span> <span class="string">&quot;/web/cgi-bin/&quot;</span></span><br><span class="line">&lt;Location <span class="string">&quot;/cgi-bin&quot;</span>&gt;</span><br><span class="line">    SetHandler cgi-script</span><br><span class="line">    Options +ExecCGI</span><br><span class="line">&lt;/Location&gt;</span><br></pre></td></tr></table></figure>



<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line">[root@VM httpd]<span class="comment"># vi extra/httpd-vhosts.conf    # 调整配置文件</span></span><br><span class="line">&lt;IfModule alias_module&gt;</span><br><span class="line">    <span class="comment">#</span></span><br><span class="line">    ScriptAlias /cgi-bin/ <span class="string">&quot;/usr/local/apache/cgi-bin/&quot;</span>      </span><br><span class="line">    <span class="comment"># 定义目录/cgi-bin/ 目录映射到 /usr/local/apache/cgi-bin/ 目录 </span></span><br><span class="line">&lt;/IfModule&gt;</span><br><span class="line"></span><br><span class="line">&lt;Directory <span class="string">&quot;/usr/local/apache/cgi-bin&quot;</span>&gt;    <span class="comment"># 定义目录属性 </span></span><br><span class="line">    AllowOverride none</span><br><span class="line">    Options none</span><br><span class="line">    Require all granted</span><br><span class="line">&lt;/Directory&gt;</span><br><span class="line"></span><br><span class="line">[root@VM cgi-bin]<span class="comment"># vi   test1      # 在cgi-bin目录中创建test1 bash 脚本 </span></span><br><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line">cat &lt;&lt; EOF</span><br><span class="line">Content-Type: text/html</span><br><span class="line">                            <span class="comment"># 注意改行为空行 </span></span><br><span class="line">&lt;pre&gt;</span><br><span class="line">&lt;h1&gt;The hostname is `hostname`. &lt;/h1&gt;     <span class="comment"># 显示主机名 ，使用bash命令 hostname 实现 </span></span><br><span class="line">The time is `date`.                    <span class="comment"># 显示当前访问日期 ，使用bash命令 date 实现</span></span><br><span class="line">&lt;/pre&gt;</span><br><span class="line">                            <span class="comment"># 改行为空行 </span></span><br><span class="line">EOF</span><br><span class="line">    </span><br><span class="line">[root@VM cgi-bin]<span class="comment"># vi test2           # 在cgi-bin目录中创建test2   perl 脚本 </span></span><br><span class="line"><span class="meta">#!/usr/bin/perl</span></span><br><span class="line"><span class="built_in">print</span> <span class="string">&quot;content-type: text/html&quot;</span>,<span class="string">&quot;\n\n&quot;</span>;</span><br><span class="line"><span class="built_in">print</span> <span class="string">&quot;&lt;HTML&gt;&quot;</span>,<span class="string">&quot;\n&quot;</span>;</span><br><span class="line"><span class="built_in">print</span> <span class="string">&quot;&lt;HEAD&gt;&quot;</span>,<span class="string">&quot;\n&quot;</span>;</span><br><span class="line"><span class="built_in">print</span> <span class="string">&quot;&lt;TITLE&gt;Perl&lt;/TITLE&gt;&quot;</span>,<span class="string">&quot;\n&quot;</span>;</span><br><span class="line"><span class="built_in">print</span> <span class="string">&quot;&lt;/HEAD&gt;&quot;</span>,<span class="string">&quot;\n&quot;</span>;</span><br><span class="line"><span class="built_in">print</span> <span class="string">&quot;&lt;BODY&gt;&quot;</span>,<span class="string">&quot;\n&quot;</span>;</span><br><span class="line"><span class="built_in">print</span> <span class="string">&quot;&lt;H1&gt;Hello World&lt;/H1&gt;&quot;</span>,<span class="string">&quot;\n&quot;</span>;</span><br><span class="line"><span class="built_in">print</span> <span class="string">&quot;&lt;/BODY&gt;&quot;</span>,<span class="string">&quot;\n&quot;</span>;</span><br><span class="line"><span class="built_in">print</span> <span class="string">&quot;&lt;/HTML&gt;&quot;</span>,<span class="string">&quot;\n&quot;</span>;</span><br><span class="line"></span><br><span class="line">[root@VM ]<span class="comment"># chmod o+x /usr/local/apache/cgi-bin/&#123;test1,test2&#125;     # 注意 ，一定要给与脚本执行权限  </span></span><br><span class="line"></span><br><span class="line">[root@VM cgi-bin]<span class="comment"># curl http://192.168.4.160/cgi-bin/test1            # 测试 test1 脚本执行状况</span></span><br><span class="line">&lt;pre&gt;</span><br><span class="line">&lt;h1&gt;The hostname is VM. &lt;/h1&gt;</span><br><span class="line">The time is Wed Aug 15 19:26:56 CST 2018.</span><br><span class="line">&lt;/pre&gt;</span><br><span class="line"></span><br><span class="line">[root@VM cgi-bin]<span class="comment"># curl http://192.168.4.160/cgi-bin/test2      #  测试test2  perl脚本执行状况</span></span><br><span class="line">&lt;HTML&gt;</span><br><span class="line">&lt;HEAD&gt;</span><br><span class="line">&lt;TITLE&gt;Perl&lt;/TITLE&gt;</span><br><span class="line">&lt;/HEAD&gt;</span><br><span class="line">&lt;BODY&gt;</span><br><span class="line">&lt;H1&gt;Hello World&lt;/H1&gt;</span><br><span class="line">&lt;/BODY&gt;</span><br><span class="line">&lt;/HTML&gt;</span><br></pre></td></tr></table></figure>



<p>windows测试：</p>
<p>​    <img src="https://s1.51cto.com/images/20180816/1534357447355109.png?x-oss-process=image/watermark,size_16,text_QDUxQ1RP5Y2a5a6i,color_FFFFFF,t_100,g_se,x_10,y_10,shadow_90,type_ZmFuZ3poZW5naGVpdGk=" alt="image.png"></p>
<p>​    <img src="https://s1.51cto.com/images/20180816/1534357477367628.png?x-oss-process=image/watermark,size_16,text_QDUxQ1RP5Y2a5a6i,color_FFFFFF,t_100,g_se,x_10,y_10,shadow_90,type_ZmFuZ3poZW5naGVpdGk=" alt="image.png"></p>
<h3 id="11、VirtualHost指令-，虚拟主机配置"><a href="#11、VirtualHost指令-，虚拟主机配置" class="headerlink" title="11、VirtualHost指令 ，虚拟主机配置"></a>11、VirtualHost指令 ，虚拟主机配置</h3><p><VirtualHost>及</VirtualHost>用于包含一组仅适用于特定虚拟主机的指令。当服务器在特定虚拟主机上收到对文档的请求时，它将使用该<VirtualHost> 部分中包含的配置指令。   </p>
<p>​    语法：&lt;VirtualHost addr[:port] [addr[:port]] …&gt; … </VirtualHost></p>
<ul>
<li>addr可以是以下任何一个，可选地后跟冒号和端口号（或*）：</li>
</ul>
<p>​    虚拟主机的IP地址 ；</p>
<p>​    虚拟主机IP地址的完全限定域名（不推荐）;</p>
<p>​    字符 * ，充当通配符并匹配任何IP地址；</p>
<p>​    字符串”<em>default</em>“，是”*”的别名</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line">[root@VM httpd]<span class="comment"># vi /etc/httpd/httpd.conf     # 调整httpd.conf 主配置文件</span></span><br><span class="line">   <span class="comment">#DocumentRoot &quot;/usr/local/apache/htdocs&quot;    # 注释掉web站点的根目录 ，行首加 “#”。</span></span><br><span class="line">   Include /etc/httpd/extra/httpd-vhosts.conf     <span class="comment"># 取消行首的注释“#” ，使能httpd-vhosts.conf 文件</span></span><br><span class="line"></span><br><span class="line">[root@VM httpd]<span class="comment"># vi extra/httpd-vhosts.conf </span></span><br><span class="line"></span><br><span class="line">&lt;VirtualHost 192.168.4.160:80&gt;    <span class="comment"># 定义虚拟主机的访问ip为 192.168.4.160:80 ，访问主机名 www.itwish.cn</span></span><br><span class="line">    ServerAdmin webmaster@itwish.cn         <span class="comment"># 定义主机管理邮箱地址</span></span><br><span class="line">    DocumentRoot <span class="string">&quot;/usr/local/apache/htdocs/itwish.cn&quot;</span>      <span class="comment"># 定义该虚拟主机的根目录</span></span><br><span class="line">    ServerName  www.itwish.cn                <span class="comment"># 定义虚拟主机名称</span></span><br><span class="line">    ServerAlias www.itwish.cn                   <span class="comment"># 定义Servername 的别名</span></span><br><span class="line">    ErrorLog <span class="string">&quot;logs/itwish.cn-error_log&quot;</span>     <span class="comment"># 定义错误日志路径 </span></span><br><span class="line">    CustomLog <span class="string">&quot;logs/itwish.cn-access_log&quot;</span> common      <span class="comment"># 定义访问日志目录 </span></span><br><span class="line">        &lt;Directory <span class="string">&quot;/usr/local/apache/docs/itwish.cn&quot;</span>&gt; <span class="comment"># 对根目录设置页面访问属性 ，定义Directory 指令开始范围</span></span><br><span class="line">                Options Indexes FollowSymlinks</span><br><span class="line">                AllowOverride None</span><br><span class="line">                Require all granted</span><br><span class="line">        &lt;/Directory&gt;                <span class="comment"># 定义Directory 指令结束范围 </span></span><br><span class="line">&lt;/VirtualHost&gt;         <span class="comment"># 定义VirtualHost 指令的结束范围 </span></span><br><span class="line">  </span><br><span class="line">&lt;VirtualHost 192.168.4.170:80&gt;  <span class="comment"># 定义虚拟主机的访问ip为 192.168.4.160:80 ，访问主机名 www.itwish.cn</span></span><br><span class="line">    ServerAdmin webmaster@itwish.org</span><br><span class="line">    DocumentRoot <span class="string">&quot;/usr/local/apache/htdocs/itwish.org&quot;</span></span><br><span class="line">    ServerName  www.itwish.org</span><br><span class="line">    ServerAlias www.itwish.org</span><br><span class="line">    ErrorLog <span class="string">&quot;logs/itwish.org-error_log&quot;</span></span><br><span class="line">    CustomLog <span class="string">&quot;logs/itwish.org-access_log&quot;</span> common</span><br><span class="line">        &lt;Directory <span class="string">&quot;/usr/local/apache/docs/itwish.org&quot;</span>&gt;</span><br><span class="line">                Options Indexes FollowSymlinks</span><br><span class="line">                AllowOverride None</span><br><span class="line">                Require all granted</span><br><span class="line">        &lt;/Directory&gt;</span><br><span class="line">&lt;/VirtualHost&gt;</span><br><span class="line"></span><br><span class="line">[root@VM httpd]<span class="comment"># mkdir /usr/local/apache/htdocs/&#123;itwish.cn,itwish.org&#125;    # 创建虚拟主机的根目录</span></span><br><span class="line"></span><br><span class="line">[root@VM httpd]<span class="comment"># cd /usr/local/apache/htdocs/</span></span><br><span class="line"></span><br><span class="line">[root@VM htdocs]<span class="comment"># ls</span></span><br><span class="line">index.html  itwish.cn  itwish.org</span><br><span class="line"></span><br><span class="line">[root@VM htdocs]<span class="comment"># vi itwish.cn/index.html        # 编辑虚拟主机 www.itwish.cn 访问主页  </span></span><br><span class="line">&lt;html&gt;&lt;body&gt;&lt;h1&gt;www.itwish.cn   works!&lt;/h1&gt;&lt;/body&gt;&lt;/html&gt;</span><br><span class="line"></span><br><span class="line">[root@VM htdocs]<span class="comment"># vi itwish.org/index.html        # 编辑虚拟主机 www.itwish.org  访问主页  </span></span><br><span class="line">&lt;html&gt;&lt;body&gt;&lt;h1&gt;itwish.org   works!&lt;/h1&gt;&lt;/body&gt;&lt;/html&gt;</span><br><span class="line"></span><br><span class="line">[root@VM httpd]<span class="comment"># vi /etc/hosts        # 添加以下虚拟主机域名解析 地址</span></span><br><span class="line">192.168.4.160 vm.itwish.cn vm www.itwish.cn</span><br><span class="line">192.168.4.170 www.itwish.org</span><br><span class="line"></span><br><span class="line"> [root@VM htdocs]<span class="comment"># curl http://www.itwish.cn     # 测试 ，主页面显示正常</span></span><br><span class="line">&lt;html&gt;&lt;body&gt;&lt;h1&gt;www.itwish.cn  works!&lt;/h1&gt;&lt;/body&gt;&lt;/html&gt;</span><br><span class="line">                                             </span><br><span class="line">[root@VM htdocs]<span class="comment"># curl http://www.itwish.org  # 测试 ，主页面显示正常 </span></span><br><span class="line">&lt;html&gt;&lt;body&gt;&lt;h1&gt;itwish.org   works!&lt;/h1&gt;&lt;/body&gt;&lt;/html&gt;</span><br></pre></td></tr></table></figure>



<p>windows 主机测试，简要实现 ，未配置域名解析 ，直接通过ip进行访问：</p>
<p><img src="https://s1.51cto.com/images/20180816/1534357753771755.png?x-oss-process=image/watermark,size_16,text_QDUxQ1RP5Y2a5a6i,color_FFFFFF,t_100,g_se,x_10,y_10,shadow_90,type_ZmFuZ3poZW5naGVpdGk=" alt="image.png">    <img src="https://s1.51cto.com/images/20180816/1534357541157267.png?x-oss-process=image/watermark,size_16,text_QDUxQ1RP5Y2a5a6i,color_FFFFFF,t_100,g_se,x_10,y_10,shadow_90,type_ZmFuZ3poZW5naGVpdGk=" alt="image.png"></p>
<h3 id="12、ErrorLog-与-LogFormat-指令，定义web访问-Log日志"><a href="#12、ErrorLog-与-LogFormat-指令，定义web访问-Log日志" class="headerlink" title="12、ErrorLog 与 LogFormat 指令，定义web访问 Log日志"></a>12、ErrorLog 与 LogFormat 指令，定义web访问 Log日志</h3><p>定义web访问日志路径及日志格式</p>
<p>​    语法1：ErrorLog file-path|syslog[:[facility][:tag]]   </p>
<p>​    语法2：LogFormat format|nickname [nickname]</p>
<p>​    语法3：CustomLog file|pipe format|nickname [env=[!]environment-variable| expr=expression] </p>
<ul>
<li>定义日志格式各项参数涵义，请参考官网文档：<a target="_blank" rel="noopener" href="https://httpd.apache.org/docs/2.4/mod/mod_log_config.html#formats">https://httpd.apache.org/docs/2.4/mod/mod_log_config.html#formats</a> </li>
</ul>
<p>​    %h：客户端地址</p>
<p>​    %l：远程的登录名，通常为-</p>
<p>​    %u：认证时的远程用户名，通常为-</p>
<p>​    %t：接收到的请求时的时间，为标准英文格式时间+时区</p>
<p>​    &quot; ：斜杠时为后面内容做转义</p>
<p>​    %r：请求报文的起始行</p>
<p>​    %&gt;s：响应状态码，</p>
<p>​    %b：以字节响应报文的长度，不包含http报文</p>
<p>​    %{Header_Name}i：记录指定请求报文首部的内容（value）</p>
<p>​    %u：请求的URL</p>
<ul>
<li>常用日志格式：</li>
</ul>
<p>​    通用日志格式（CLF）： “%h %l %u %t &quot;%r&quot; %&gt;s %b”</p>
<p>​    虚拟主机的通用日志格式：”%v %h %l %u %t &quot;%r&quot; %&gt;s %b”</p>
<p>​    NCSA扩展/组合日志格式 ：”%h %l %u %t &quot;%r&quot; %&gt;s %b &quot;%{Referer}i&quot; &quot;%{User-agent}i&quot;“</p>
<p>​    引用日志格式 ：”%{Referer}i -&gt; %U”</p>
<p>​    代理（浏览器）日志格式： “%{User-agent}i” </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">[root@VM httpd]<span class="comment"># vi /etc/httpd/httpd.conf     # 调整httpd.conf 主配置文件</span></span><br><span class="line">ErrorLog <span class="string">&quot;logs/error_log&quot;</span>        <span class="comment"># 错误日志路径</span></span><br><span class="line">LogLevel warn        <span class="comment"># 日志等级warn</span></span><br><span class="line">&lt;IfModule log_config_module&gt;</span><br><span class="line">    <span class="comment">#</span></span><br><span class="line">    LogFormat <span class="string">&quot;%h %l %u %t \&quot;%r\&quot; %&gt;s %b \&quot;%&#123;Referer&#125;i\&quot; \&quot;%&#123;User-Agent&#125;i\&quot;&quot;</span> combined    </span><br><span class="line">    <span class="comment"># 定义日志格式，格式名称定义为变量 combined</span></span><br><span class="line">    LogFormat <span class="string">&quot;%h %l %u %t \&quot;%r\&quot; %&gt;s %b&quot;</span> common             </span><br><span class="line">    <span class="comment"># 定义日志格式，格式名称定义为变量 common</span></span><br><span class="line"></span><br><span class="line">    &lt;IfModule logio_module&gt;</span><br><span class="line">      <span class="comment"># You need to enable mod_logio.c to use %I and %O</span></span><br><span class="line">      LogFormat <span class="string">&quot;%h %l %u %t \&quot;%r\&quot; %&gt;s %b \&quot;%&#123;Referer&#125;i\&quot; \&quot;%&#123;User-Agent&#125;i\&quot; %I %O&quot;</span> combinedio</span><br><span class="line">    &lt;/IfModule&gt;</span><br><span class="line"></span><br><span class="line">       CustomLog <span class="string">&quot;logs/access_log&quot;</span>  common    </span><br><span class="line">       <span class="comment"># 该CustomLog指令用于将请求记录到服务器。指定了日志路径，并且选择使用环境变量common作为日志的显示格式。</span></span><br><span class="line">       </span><br><span class="line">&lt;/IfModule&gt;</span><br><span class="line"></span><br><span class="line">[root@VM httpd]<span class="comment"># vi extra/httpd-vhosts.conf </span></span><br><span class="line"></span><br><span class="line">&lt;VirtualHost 192.168.4.160:80&gt;</span><br><span class="line">    ErrorLog <span class="string">&quot;logs/itwish.cn-error_log&quot;</span>    </span><br><span class="line">    CustomLog <span class="string">&quot;logs/itwish.cn-access_log&quot;</span> combined    <span class="comment"># 把日志格式变量从common 改为 combined </span></span><br><span class="line"> 或者</span><br><span class="line">    CustomLog <span class="string">&quot;logs/itwish.cn-access_log&quot;</span>  <span class="string">&quot;%v %h %l %u %t \&quot;%r\&quot; %&gt;s %b&quot;</span></span><br><span class="line">&lt;/VirtualHost&gt;</span><br><span class="line"> </span><br><span class="line">[root@VM httpd]<span class="comment"># vi /usr/local/apache/logs/itwish.cn-access_log    </span></span><br><span class="line"><span class="comment"># 查看访问日志 ，通过日志显示内容对比 common变量格式 与 combined 变量格式的不同 </span></span><br><span class="line">192.168.4.160 - - [15/Aug/2018:15:56:40 +0800] <span class="string">&quot;HEAD / HTTP/1.1&quot;</span> 200 -</span><br><span class="line">192.168.4.160 - - [15/Aug/2018:15:56:52 +0800] <span class="string">&quot;GET / HTTP/1.1&quot;</span> 200 105</span><br><span class="line">192.168.4.201 - - [15/Aug/2018:16:00:13 +0800] <span class="string">&quot;GET /favicon.ico HTTP/1.1&quot;</span> 404 209</span><br><span class="line">192.168.4.201 - - [15/Aug/2018:16:00:17 +0800] <span class="string">&quot;GET /favicon.ico HTTP/1.1&quot;</span> 404 209 </span><br><span class="line">192.168.4.201 - - [15/Aug/2018:17:20:01 +0800] <span class="string">&quot;GET / HTTP/1.1&quot;</span> 304 - <span class="string">&quot;-&quot;</span> <span class="string">&quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/67.0.3</span></span><br><span class="line"><span class="string">396.99 Safari/537.36&quot;</span></span><br><span class="line">192.168.4.201 - - [15/Aug/2018:17:20:06 +0800] <span class="string">&quot;GET / HTTP/1.1&quot;</span> 200 57 <span class="string">&quot;-&quot;</span> <span class="string">&quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/64.0.</span></span><br><span class="line"><span class="string">3282.140 Safari/537.36 Edge/17.17134&quot;</span></span><br></pre></td></tr></table></figure>



<h3 id="13、httpd网页认证"><a href="#13、httpd网页认证" class="headerlink" title="13、httpd网页认证"></a>13、httpd网页认证</h3><p> httpd对web身份认证的支持很丰富，提供的控制也非常细致。见<a target="_blank" rel="noopener" href="http://httpd.apache.org/docs/2.4/mod/">http://httpd.apache.org/docs/2.4/mod/</a>   </p>
<ul>
<li>认证方式</li>
</ul>
<p>​    httpd服务器支持使用摘要认证(Digest)和基本认证(Basic)两种方式</p>
<p>​    Digest：使用摘要认证需要在编译httpd之前添加”–enable-auth-digest”选项，但并不是所有的浏览器都支持摘要认证，不推荐使用;</p>
<p>​    Basic：基本认证是htpd服务的基本功能，不需要预先配置特别的选项（安全性没有摘要认证高，但支持所有的浏览器）</p>
<ul>
<li>通过用户名和密码形式限制访问方式：   </li>
</ul>
<p>​    AllowOverride Authconfig       # 启用用户认证    </p>
<p>​    AuthName “Auth Direcrory”   # 指定认证名称，登录的时候会通过登录窗口显示</p>
<p>​    AuthType Basic | Digest          # 指定认证方式 Basic 或 Digest</p>
<p>​    AuthUserFile /usr/local/apache/.htpasspwd   # 指定授权用户数据文件，由htpasswd命令生成。</p>
<p>​    AuthGroupFile file-path  # 指定组认证文件，文件中分组格式为”mygroup: Jon Bob “。如果文件路径为相对路径，则相对于ServerRoot</p>
<p>​    Require valid-user    # 授权给合法用户，合法用户在.htpasspwd文件中  </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">[root@VM httpd]<span class="comment"># vi /etc/httpd/httpd.conf     # 调整httpd.conf 主配置文件</span></span><br><span class="line">   <span class="comment">#DocumentRoot &quot;/usr/local/apache/htdocs&quot;    # 注释掉web站点的根目录 ，行首加 “#”。</span></span><br><span class="line">   Include /etc/httpd/extra/httpd-vhosts.conf     <span class="comment"># 取消行首的注释“#” ，使能httpd-vhosts.conf 文件</span></span><br><span class="line"></span><br><span class="line">[root@VM httpd]<span class="comment"># vi extra/httpd-vhosts.conf </span></span><br><span class="line"></span><br><span class="line">&lt;VirtualHost 192.168.4.170:80&gt;           <span class="comment"># 定义虚拟主机的访问ip为 192.168.4.160:80 ，访问主机名 www.itwish.cn</span></span><br><span class="line">    ServerAdmin webmaster@itwish.org        </span><br><span class="line">    DocumentRoot <span class="string">&quot;/usr/local/apache/htdocs/itwish.org&quot;</span>      <span class="comment"># 定义该虚拟主机的根目录</span></span><br><span class="line">    ServerName  www.itwish.org               </span><br><span class="line">    ServerAlias www.itwish.org                 </span><br><span class="line">    ErrorLog <span class="string">&quot;logs/itwish.org-error_log&quot;</span>     <span class="comment"># 定义错误日志路径 </span></span><br><span class="line">    CustomLog <span class="string">&quot;logs/itwish.org-access_log&quot;</span> common      <span class="comment"># 定义web访问日志目录及日志格式</span></span><br><span class="line">        &lt;Directory <span class="string">&quot;/usr/local/apache/htdocs/itwish.org&quot;</span>&gt; <span class="comment"># 对根目录设置页面访问属性 ，定义Directory 指令开始范围</span></span><br><span class="line">                Options Indexes FollowSymlinks</span><br><span class="line">                AllowOverride Authconfig   <span class="comment"># 定义用户访问认证</span></span><br><span class="line">                AuthType  Basic</span><br><span class="line">                AuthName <span class="string">&quot;Input Your name and password&quot;</span></span><br><span class="line">                AuthUserFile   <span class="string">&quot;/usr/local/apache/.htpasspwd&quot;</span> <span class="comment"># 用户认证文件</span></span><br><span class="line">                AuthGroupFile  <span class="string">&quot;/usr/local/apache/.group&quot;</span>   <span class="comment"># 组认证文件</span></span><br><span class="line">                Require Valid-user     <span class="comment"># 或者直接使用  Require user itwish,tom  </span></span><br><span class="line">                Require group Auth   <span class="comment"># 允许</span></span><br><span class="line">        &lt;/Directory&gt;                <span class="comment"># 定义Directory 指令结束范围 </span></span><br><span class="line">&lt;/VirtualHost&gt;         <span class="comment"># 定义VirtualHost 指令的结束范围 </span></span><br><span class="line">  </span><br><span class="line">[root@VM httpd]<span class="comment"># htpasswd -cb /usr/local/apache/.htpasspwd itwish itwish   # 添加认证用户并指定认证文件 </span></span><br><span class="line">Adding password <span class="keyword">for</span> user itwish</span><br><span class="line"></span><br><span class="line">[root@VM httpd]<span class="comment"># htpasswd -b /usr/local/apache/.htpasspwd tom tom   # 添加认证用户</span></span><br><span class="line">Adding password <span class="keyword">for</span> user tom</span><br><span class="line"></span><br><span class="line">[root@VM httpd]<span class="comment"># echo &quot;Auth:tom&quot; &gt;&gt; /usr/local/apache/.groupname    # 添加用户到认证组Auth</span></span><br><span class="line">[root@VM httpd]<span class="comment"># vi /usr/local/apache/.groupname</span></span><br><span class="line">Auth:tom</span><br></pre></td></tr></table></figure>



<p>windows客户端测试：分别测试用户名itwish  和 tom  都可正常访问主页 Index.html </p>
<p>​    <img src="https://s1.51cto.com/images/20180815/1534348602858318.png?x-oss-process=image/watermark,size_16,text_QDUxQ1RP5Y2a5a6i,color_FFFFFF,t_100,g_se,x_10,y_10,shadow_90,type_ZmFuZ3poZW5naGVpdGk=" alt="image.png"></p>
<h3 id="14、-指令-，SetHandler-指令-，配置主页stauts-页面"><a href="#14、-指令-，SetHandler-指令-，配置主页stauts-页面" class="headerlink" title="14、 指令 ，SetHandler 指令 ，配置主页stauts 页面"></a>14、<Location> 指令 ，SetHandler 指令 ，配置主页stauts 页面</h3><p>该<Location>指令通过URL限制所附指令的范围。它与<Directory> 指令类似 ，并启动一个以</Location>指令终止的子节 .</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">[root@VM httpd]<span class="comment"># vi httpd.conf    # 配置httpd.conf主文件，并加载以下DSO模块 </span></span><br><span class="line">LoadModule authz_host_module modules/mod_authz_host.so</span><br><span class="line">LoadModule authz_core_module modules/mod_authz_core.so</span><br><span class="line">LoadModule status_module modules/mod_status.so</span><br><span class="line">LoadModule info_module modules/mod_info.so</span><br><span class="line"></span><br><span class="line"><span class="comment"># Real-time info on requests and configuration</span></span><br><span class="line">Include /etc/httpd/extra/httpd-info.conf     <span class="comment"># 启用扩展文件</span></span><br><span class="line"></span><br><span class="line">[root@VM extra]<span class="comment"># vi httpd-info.conf # 配置httpd-info.conf文件，建议指定用户访问。</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Get information about the requests being processed by the server</span></span><br><span class="line"><span class="comment"># and the configuration of the server.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Required modules: mod_authz_core, mod_authz_host,    # 依赖指定的模块</span></span><br><span class="line"><span class="comment">#                   mod_info (for the server-info handler),</span></span><br><span class="line"><span class="comment">#                   mod_status (for the server-status handler</span></span><br><span class="line">&lt;Location /server-status&gt;</span><br><span class="line">    SetHandler server-status</span><br><span class="line">        AllowOverride Authconfig        <span class="comment"># 配置用户认证</span></span><br><span class="line">        Authtype Basic</span><br><span class="line">        AuthName <span class="string">&quot;Input The message&quot;</span></span><br><span class="line">        AuthUserFile <span class="string">&quot;/usr/local/apache/.htpasspwd&quot;</span></span><br><span class="line">        Require Valid-user</span><br><span class="line">&lt;/Location&gt;</span><br></pre></td></tr></table></figure>



<p>windows 测试：</p>
<p>​    <img src="https://s1.51cto.com/images/20180816/1534350821516420.png?x-oss-process=image/watermark,size_16,text_QDUxQ1RP5Y2a5a6i,color_FFFFFF,t_100,g_se,x_10,y_10,shadow_90,type_ZmFuZ3poZW5naGVpdGk=" alt="image.png"></p>
<p>综上，关于httpd.conf 配置文件介绍完毕  。更多指令及使用方式可参考官方文档：<a target="_blank" rel="noopener" href="https://httpd.apache.org/docs/2.4/mod/directives.html">https://httpd.apache.org/docs/2.4/mod/directives.html</a> </p>
</div><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">俞超超</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://gschaos.club/2018/08/16/httpd%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E8%AF%A6%E8%A7%A3/">https://gschaos.club/2018/08/16/httpd%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E8%AF%A6%E8%A7%A3/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://gschaos.club" target="_blank">MysticalYcc</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E6%9C%8D%E5%8A%A1%E5%99%A8/">服务器</a></div><div class="post_share"><div class="social-share" data-image="/null" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2018/08/19/Java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E/"><img class="prev-cover" src="/null" onerror="onerror=null;src='/img/404.jpg'"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">Java反序列化漏洞</div></div></a></div><div class="next-post pull-right"><a href="/2018/05/06/SeaweedFS/"><img class="next-cover" src="/null" onerror="onerror=null;src='/img/404.jpg'"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">SeaweedFS</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span> 相关推荐</span></div><div class="relatedPosts-list"><div><a href="/2020/08/28/Linux设置虚拟内存/" title="Linux设置虚拟内存"><img class="cover" src="/null"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2020-08-28</div><div class="title">Linux设置虚拟内存</div></div></a></div></div></div></article></main><footer id="footer" data-type="color"><div id="footer-wrap"><div class="copyright">&copy;2020 By 俞超超</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><section id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></section><div><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><div class="js-pjax"><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></div></body></html>